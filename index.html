<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>MARKETING DIGITAL / DIGITAL MARKETING</title>
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">
<style>
:root{--gold:#F8AC10;--red:rgb(240,50,70);--brown:#9b835a}
*{box-sizing:border-box}
html,body{margin:0;padding:0;height:100%;background:black;color:white;font-family:'Special Elite',monospace}
body{max-width:1000px;margin:0 auto;padding-top:130px;padding-bottom:20px}

/* podkÅ‚adka od samej gÃ³ry do poczÄ…tku playerÃ³w */
#headerBackground{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:130px; /* od gÃ³ry do poczÄ…tku playerÃ³w */
  background:black;
  z-index:1000;
}

h1{
  position:fixed;
  top:0;
  left:50%;
  transform:translateX(-50%);
  text-align:center;
  margin:0;
  padding:10px 0;
  background:transparent;
  z-index:1001;
  color:var(--gold);
}
#buttonsContainer{
  position:fixed;
  top:50px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  justify-content:center;
  gap:15px;
  flex-wrap:nowrap;
  z-index:1001;
  padding:10px 0;
  background:transparent;
}

button{font-family:'Special Elite',monospace;border:0px solid #fff;cursor:pointer}
#playAllButton,#playESButton,#playENButton,#resetAllButton{background:var(--gold);color:black;width:140px;height:45px;border-radius:5px;display:flex;align-items:center;justify-content:center;padding:0 5px}
#stopAllButton{background:#ff0000;color:white;width:140px;height:45px;border-radius:5px}
.player{display:flex;align-items:flex-start;gap:15px;margin-bottom:40px;cursor:pointer}
.player button{background:var(--gold);color:black;width:45px;height:45px;border-radius:50%;font-size:25px;display:flex;align-items:center;justify-content:center;margin-right:15px}
.karaoke-line{font-size:32px;display:flex;flex-wrap:wrap;gap:16px;align-items:center;justify-content:flex-start;padding-top:10px;text-align:left}
.word{transition:color .08s}
.completed{color:var(--brown)}
/* modal simplified */
#fullscreenModal{display:none;position:fixed;left:0;top:0;width:100%;height:100%;justify-content:center;align-items:center;flex-direction:column;z-index:9999;background:black;padding:20px;overflow:auto}
#fullscreenModal .karaoke-line{font-size:48px;gap:24px;max-width:90%;margin:0 auto 30px;white-space:pre-wrap;justify-content:center}
.fullscreen-audio-wrapper{display:flex;gap:30px;margin-top:25px;justify-content:center}
#fullscreenAudio{width:0;height:0;opacity:0}
#modalPlayButton,#modalPrevButton,#modalNextButton,#fullscreenClose{font-family:'Special Elite',monospace;background:var(--gold);border:0px solid #fff;color:black;cursor:pointer}
#modalPlayButton,#modalPrevButton,#modalNextButton{width:70px;height:70px;border-radius:50%;font-size:32px;display:flex;align-items:center;justify-content:center}
#fullscreenClose{position:absolute;top:20px;right:20px;padding:5px 10px;border-radius:5px;font-size:24px;background:var(--red);color:white}

#preloader{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:black;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:10001; /* zawsze nad wszystkimi elementami */
}
#preloader img{width:150px;margin-bottom:20px}
#preloader .dots{display:flex;gap:5px;align-items:center}
#preloader span{font-size:32px;margin:0 5px;display:flex;align-items:center;gap:5px}
.dot{color:white;animation:blink 1s infinite}@keyframes blink{0%,50%,100%{opacity:1}25%,75%{opacity:0}}
#preloader .yellow{color:var(--gold)}
#preloader .red{color:var(--red)}

@media(max-width:480px){
  #fullscreenModal .karaoke-line{font-size:34px}
  #modalPlayButton,#modalPrevButton,#modalNextButton{width:65px;height:65px;font-size:30px}
  #playAllButton,#playESButton,#playENButton,#resetAllButton,#stopAllButton{width:45%;font-size:14px}
}
</style>
</head>
<body>

<div id="headerBackground"></div>

<div id="preloader">
  <img src="logo.png" alt="Logo">
  <div class="dots">
    <span class="yellow">cargando para ti</span>
    <span class="dot">â€¢</span>
    <span class="dot">â€¢</span>
    <span class="dot">â€¢</span>
    <span class="red">loading for you</span>
  </div>
</div>

<h1>MARKETING DIGITAL / DIGITAL MARKETING</h1>

<div id="buttonsContainer">
  <button id="playAllButton">â–¶ PLAY ALL</button>
  <button id="playESButton">ðŸ‡ªðŸ‡¸ PLAY SPANISH</button>
  <button id="playENButton">ðŸ‡ºðŸ‡¸ PLAY ENGLISH</button>
  <button id="resetAllButton">RESET ALL</button>
  <button id="stopAllButton">ðŸ›‘ STOP ALL</button>
</div>

<div id="players"></div>

<div id="fullscreenModal" aria-hidden="true">
  <button id="fullscreenClose">âœ–</button>
  <div id="fullscreenContent"></div>
  <div class="fullscreen-audio-wrapper">
    <button id="modalPrevButton">â—€</button>
    <button id="modalPlayButton">â–¶</button>
    <button id="modalNextButton">â–¶</button>
    <audio id="fullscreenAudio"></audio>
  </div>
</div>

<script>
const BASE_URL='https://raw.githubusercontent.com/xpanol/PLAYERS/main/';
const TRACK_COUNT=30;
const playersContainer=document.getElementById('players');
const sequenceAudio=new Audio();
let playerControls=[],activeSequenceList=[],isPlayingAll=false,currentTrackIndex=0,currentAudioPlaying=null,highlightRaf=null,activePlayButton=null;

const el={modal:document.getElementById('fullscreenModal'),modalContent:document.getElementById('fullscreenContent'),modalAudio:document.getElementById('fullscreenAudio'),modalPlayButton:document.getElementById('modalPlayButton'),modalPrevButton:document.getElementById('modalPrevButton'),modalNextButton:document.getElementById('modalNextButton'),modalClose:document.getElementById('fullscreenClose'),stopAllButton:document.getElementById('stopAllButton')};

function stopHighlight(){ if(highlightRaf){ cancelAnimationFrame(highlightRaf); highlightRaf=null } }
function clearSpanStyles(s){ s.classList.remove('completed'); s.removeAttribute('style') }
function scrollToCurrentTrack(i){ if(i>=0 && i<playerControls.length){ const div=playerControls[i].playBtn.closest('.player'); if(div) div.scrollIntoView({behavior:'smooth',block:'center'}) } }

function startHighlightForAudio(audio, spans){
  stopHighlight();
  if(!spans.length) return;
  const lastEnd = parseFloat(spans[spans.length-1].dataset.end) || 0;
  let running=true;
  function loop(){
    if(!running) return;
    const t = audio.currentTime || 0;
    for(const span of spans){
      const s = parseFloat(span.dataset.start) || 0;
      const e = parseFloat(span.dataset.end) || 0;
      span.classList.remove('completed');
      if(t >= s && t <= e){ span.style.color = (span.dataset.type==='z') ? 'rgb(240,50,70)' : 'var(--gold)'; }
      else { span.style.color = 'white'; }
    }
    if(t >= lastEnd){ running=false; stopHighlight(); for(const sp of spans){ sp.classList.add('completed'); sp.removeAttribute('style'); sp.style.color='var(--brown)' } return; }
    highlightRaf = requestAnimationFrame(loop);
  }
  highlightRaf = requestAnimationFrame(loop);
}

const order=[],orderES=[],orderEN=[];
for(let i=1;i<=TRACK_COUNT;i++){
  const num=String(i).padStart(3,'0');
  const es={audio:BASE_URL+num+'_es.mp3',json:BASE_URL+num+'_es.json',type:'es',id:`es_${num}`};
  const en={audio:BASE_URL+'Z'+num+'_en.mp3',json:BASE_URL+'Z'+num+'_en.json',type:'z',id:`en_${num}`};
  order.push(es,en); orderES.push(es); orderEN.push(en);
}
activeSequenceList = order;

async function loadKaraoke(audioFile,jsonFile,container,type){
  try{
    const res = await fetch(jsonFile);
    if(!res.ok) return;
    const data = await res.json();
    if(!data || !data.length) return;
    const playerDiv=document.createElement('div'); playerDiv.className='player';
    const controlsDiv=document.createElement('div'); controlsDiv.className='audio-container';
    const playBtn=document.createElement('button'); playBtn.textContent='â–¶';
    controlsDiv.appendChild(playBtn);
    const karaokeDiv=document.createElement('div'); karaokeDiv.className='karaoke-line';
    const wordsArray=[];
    for(const item of data){
      const words=item.text.split(' ');
      const start=item.start.split(':').reduce((a,t)=>60*a+ +t,0);
      const end=item.end.split(':').reduce((a,t)=>60*a+ +t,0);
      const dur=end-start; const wdur=dur/words.length;
      words.forEach((w,j)=>{
        const span=document.createElement('span');
        span.textContent = w+' ';
        span.dataset.start=(start+j*wdur).toFixed(2);
        span.dataset.end=(start+(j+1)*wdur).toFixed(2);
        span.dataset.type = type;
        span.className='word';
        karaokeDiv.appendChild(span);
        wordsArray.push(span);
      });
    }
    playerDiv.appendChild(controlsDiv); playerDiv.appendChild(karaokeDiv); container.appendChild(playerDiv);
    const localAudio=new Audio(); localAudio.src=audioFile; localAudio.style.display='none'; playerDiv.appendChild(localAudio);
    localAudio.onplay = ()=>{ if(isPlayingAll) return; startHighlightForAudio(localAudio,wordsArray); currentAudioPlaying=localAudio; playBtn.textContent='âšâš' }
    localAudio.onpause = ()=>{ if(isPlayingAll) return; stopHighlight(); playBtn.textContent='â–¶' }
    localAudio.onended = ()=>{ if(isPlayingAll) return; playBtn.textContent='â–¶'; wordsArray.forEach(s=>{ s.classList.add('completed'); s.removeAttribute('style'); s.style.color='var(--brown)' }) }
    playBtn.onclick = ()=>{
      stopCurrentAudio(); currentTrackIndex=order.findIndex(o=>o.audio===audioFile); showModalAndPlay(currentTrackIndex);
    };
    playerControls.push({playBtn,localAudio,wordsArray,src:audioFile,lineStart:wordsArray.length?parseFloat(wordsArray[0].dataset.start):0,lineEnd:wordsArray.length?parseFloat(wordsArray[wordsArray.length-1].dataset.end):0,lineType:type});
  }catch(e){ console.error(e) }
}

async function loadAll(){ for(const item of order) await loadKaraoke(item.audio,item.json,playersContainer,item.type) }
loadAll().then(()=>{document.getElementById('preloader').style.display='none';});

function stopCurrentAudio(){ if(currentAudioPlaying){ currentAudioPlaying.pause(); playerControls.forEach(pc=>pc.playBtn.textContent='â–¶'); currentAudioPlaying=null; stopHighlight() } sequenceAudio.pause(); }
function resetAllHighlights(){ playerControls.forEach(pc=>{ pc.wordsArray.forEach(clearSpanStyles); pc.playBtn.textContent='â–¶' }) }

function playNextTrackSequence(){
  if(currentTrackIndex>=activeSequenceList.length){ isPlayingAll=false; activePlayButton=null; el.stopAllButton.hidden=true; currentTrackIndex=0; return; }
  const currentTrackData = activeSequenceList[currentTrackIndex];
  if(sequenceAudio.src !== currentTrackData.audio){ sequenceAudio.src = currentTrackData.audio; sequenceAudio.currentTime=0 }
  const overallIndex = order.findIndex(o=>o.audio===currentTrackData.audio);
  const trackData = playerControls[overallIndex];
  scrollToCurrentTrack(overallIndex);
  playerControls.forEach((pc,i)=>{ if(i!==overallIndex) pc.playBtn.textContent='â–¶' });
  sequenceAudio.onplay = ()=>{ trackData.playBtn.textContent='âšâš'; startHighlightForAudio(sequenceAudio,trackData.wordsArray); currentAudioPlaying=sequenceAudio }
  sequenceAudio.onpause = ()=> stopHighlight();
  sequenceAudio.onended = ()=>{ trackData.playBtn.textContent='â–¶'; trackData.wordsArray.forEach(s=>{ s.classList.add('completed'); s.removeAttribute('style'); s.style.color='var(--brown)'}); currentTrackIndex++; playNextTrackSequence() };
  const p = sequenceAudio.play();
  if(p !== undefined) p.catch(err=>{ console.error('play error',err); stopSequenceGlobally(); trackData.playBtn.textContent='â–¶' });
}

function stopSequenceGlobally(){ stopCurrentAudio(); isPlayingAll=false; activePlayButton=null; el.stopAllButton.textContent='â–¶ CONTINUE'; el.stopAllButton.style.background='var(--gold)'; el.stopAllButton.style.color='black'; el.stopAllButton.hidden=false; }
function resumeFromStopButton(){ if(currentTrackIndex>=activeSequenceList.length) return; isPlayingAll=true; el.stopAllButton.textContent='ðŸ›‘ STOP ALL'; el.stopAllButton.style.background='#ff0000'; el.stopAllButton.style.color='white'; playNextTrackSequence(); }

el.stopAllButton.onclick = ()=>{ if(el.stopAllButton.textContent==='ðŸ›‘ STOP ALL') stopSequenceGlobally(); else resumeFromStopButton() }

function startFilteredPlay(list, buttonElement){
  stopCurrentAudio(); if(isPlayingAll && activePlayButton===buttonElement){ stopSequenceGlobally(); return }
  activeSequenceList = list; currentTrackIndex = 0; resetAllHighlights(); isPlayingAll=true; activePlayButton=buttonElement;
  el.stopAllButton.textContent='ðŸ›‘ STOP ALL'; el.stopAllButton.style.background='#ff0000'; el.stopAllButton.style.color='white'; el.stopAllButton.hidden=false;
  playNextTrackSequence();
}

document.getElementById('playAllButton').onclick = ()=> startFilteredPlay(order, document.getElementById('playAllButton'));
document.getElementById('playESButton').onclick = ()=> startFilteredPlay(orderES, document.getElementById('playESButton'));
document.getElementById('playENButton').onclick = ()=> startFilteredPlay(orderEN, document.getElementById('playENButton'));
document.getElementById('resetAllButton').onclick = ()=> location.reload();

function showModalAndPlay(index){
  el.modal.style.display='flex'; el.modal.setAttribute('aria-hidden','false'); el.modalContent.innerHTML='';
  const item = order[index]; const clone = document.createElement('div'); clone.className='karaoke-line';
  fetch(item.json).then(r=>r.json()).then(data=>{
    const spans=[];
    data.forEach(it=>{
      const words=it.text.split(' '); const start=it.start.split(':').reduce((a,t)=>60*a+ +t,0); const end=it.end.split(':').reduce((a,t)=>60*a+ +t,0); const dur=end-start; const wdur=dur/words.length;
      words.forEach((w,j)=>{
        const span=document.createElement('span'); span.textContent=w+' '; span.dataset.start=(start+j*wdur).toFixed(2); span.dataset.end=(start+(j+1)*wdur).toFixed(2); span.dataset.type=item.type; span.className='word';
        const originalSpan = playerControls[index] && playerControls[index].wordsArray.find(s=>s.textContent===span.textContent);
        if(originalSpan && originalSpan.classList.contains('completed')) span.classList.add('completed');
        clone.appendChild(span); spans.push(span);
      })
    });
    el.modalContent.appendChild(clone);
    el.modalAudio.pause(); el.modalAudio.src=item.audio; el.modalAudio.currentTime=0; el.modalAudio.load();
    el.modalPlayButton.onclick = ()=>{ if(el.modalAudio.paused || el.modalAudio.ended){ if(el.modalAudio.ended) el.modalAudio.currentTime=0; spans.forEach(s=>{ s.classList.remove('completed'); s.removeAttribute('style') }); el.modalAudio.play() } else el.modalAudio.pause() }
    el.modalPrevButton.onclick = ()=>{ if(index>0){ showModalAndPlay(index-1) } }
    el.modalNextButton.onclick = ()=>{ if(index<order.length-1){ showModalAndPlay(index+1) } }
    el.modalAudio.onplay = ()=> startHighlightForAudio(el.modalAudio,spans)
    el.modalAudio.onpause = ()=> stopHighlight()
    el.modalAudio.onended = ()=> spans.forEach(s=>{ s.classList.add('completed'); s.removeAttribute('style'); s.style.color='var(--brown)'} )
  });
}

el.modalClose.onclick = ()=>{ el.modalAudio.pause(); stopHighlight(); el.modal.style.display='none'; el.modal.setAttribute('aria-hidden','true'); }

document.addEventListener('keydown', function(e){ if(e.key === 'Escape'){ el.modalClose.click(); } });
</script>

</body>
</html>
